---
import BestRoastLayout from "../layouts/BestRoastLayout.astro";
export const prerender = true;

import { getSinglePageData } from "../lib/getSinglePageData";
import { fetchTopRatedRoastsByFilter } from "../lib/graphql";
import { organiseComments } from "../lib/utils";

const variables = { id: "11586" };
const singlePage = await getSinglePageData({ variables });

const topRated = await fetchTopRatedRoastsByFilter({
  matcher: (post) =>
    (post.tags?.nodes?.map((tag) => tag.name) || []).includes("Hackney"),
  minRating: 7.5,
});
const threadedComments = organiseComments(singlePage.comments.nodes);
---

<BestRoastLayout
  pageTitle={singlePage.title}
  description={singlePage?.seo?.opengraphDescription}
  opengraphImage={singlePage?.featuredImage?.node?.sourceUrl ||
    singlePage?.seo?.opengraphImage?.sourceUrl}
  content={singlePage.content}
  topRated={topRated}
  threadedComments={threadedComments}
  postId={singlePage.pageId}
/>
